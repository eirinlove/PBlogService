<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <title>Hello, world!</title>
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>

    <link rel = "stylesheet" type="text/css" href= "/public/css/thread_view.css">
    <link rel = "stylesheet" type="text/css" href= "/public/css/write.css">
    <style>

        h1{

            margin-left: 50px;
            margin-top: 50px;
        }
        input{
            margin-left: 50px;
            width: 500px;
        }
        button{

            margin-left: 50px;
        }

    </style>
  </head>
  <body>
    <%- include('nav.ejs') %>

    <div class= "article_area">
      <div class="thread_title"> <%=thread_list(thread_data)%> 스레드
      </div>


      <div class="write_head">글쓰기
      </div>
      <span class="input_text_help">제목</span>
      <input class="input_text_title" type = "text">
      <!--<input class="input_text_context" type = "text">  취소된 부분, -> summernote 사용-->
      <div id="summernote" name="editordata"></div>
      <div class ="float_right">
        <button class= "thread_write">작성</a>
      </div>


    
    </div>


    <script>

      $(document).ready(function() {
	//여기 아래 부분
	$('#summernote').summernote({
		  height: 300,                 // 에디터 높이
		  minHeight: null,             // 최소 높이
		  maxHeight: null,             // 최대 높이
		  focus: true,                  // 에디터 로딩후 포커스를 맞출지 여부
		  lang: "ko-KR",					// 한글 설정
		  placeholder: '최대 2048자까지 쓸 수 있습니다',	//placeholder 설정
          callbacks : {   // 이미지 설정
                onImageUpload : function(files){ // 이미지 호출 함수, 드래그앤드롭, 이미지첨부 등으로 호출됨 
                    uploadSummernoteImageFile(files[0],this); // 현재 파일을 열에 등록.
                }

          }
          
	});
});


function uploadSummernoteImageFile(file, editor) {

    data = new FormData();
    data.append("img", file);
    $.ajax({

        data : data,
        type : "POST",
        url : "./upload-image",
        cache : false,
        contentType : false,
        enctype : "multipart/form-data",
        processData : false,
        success : function(response){
            $('#summernote').summernote('insertImage', response.url); // 파일의 url을 설정, 해당 url로 파일의 url을 가공할 수 있게.
        }
    });
}





      
    $('.thread_write').click(function(e){

      $('.input_text_title').val();

      var noteContext = $('.note-editable').html();
      var noteContextCheck = $('.note-editable').text();
      

      if ($('.input_text_title').val()){
        
        if (!noteContextCheck == ""){

          $.ajax({
                    method : 'POST',
                    url : '../thread<%=thread_data%>/postWriteOk',
                    data : {titleData : $('.input_text_title').val(),
                            contextData : noteContext}


          }).done(function(rep){

                  location.replace('../thread<%=thread_data%>');
                
                })

         
        }
        else { alert ('내용을 입력하세요');}


      }
      else { alert('제목을 입력하세요'); }
    })


    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>


    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js" integrity="sha384-eMNCOe7tC1doHpGoWe/6oMVemdAVTMs2xqW4mwXrXsW0L84Iytr2wi5v2QjrP/xp" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js" integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/" crossorigin="anonymous"></script>
    
  </body>
</html>